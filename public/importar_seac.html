<div style="padding: 20px;">
    <button class="btn" onclick="loadSection('importar')" 
            style="margin-bottom:25px; background: #fff; color: var(--color-principal); border: 1.5px solid var(--color-principal); display: flex; align-items: center; gap: 8px; padding: 8px 18px;">
        <span style="font-size: 18px;">‚Üê</span> <span style="font-weight: 700;">VOLVER AL SELECTOR</span>
    </button>
    
    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
        <span style="font-size: 30px;">üü¢</span>
        <h2 style="font-weight: 900; color: #10b981; margin: 0; letter-spacing: -0.02em;">Importador SEAC (Excel)</h2>
    </div>

    <div class="card-upload" style="border-top: 5px solid #10b981; background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
        <p style="font-weight: 700; color: #475569; margin-bottom: 10px;">1. Seleccione archivos Excel (.xlsx / .xls):</p>
        
        <label for="fileSEAC" style="display: block; padding: 20px; border: 2px dashed #10b981; border-radius: 10px; text-align: center; cursor: pointer; background: #f0fdf4; margin-bottom: 20px; transition: 0.3s;" onmouseover="this.style.background='#dcfce7'" onmouseout="this.style.background='#f0fdf4'">
            <span style="font-size: 24px; display: block; margin-bottom: 5px;">üìÇ</span>
            <span style="font-weight: 600; color: #166534;">Click para buscar archivos de SEAC</span>
            <input type="file" id="fileSEAC" multiple accept=".xlsx, .xls" style="display: none;" onchange="document.getElementById('file-name-seac').innerText = this.files.length + ' archivos seleccionados'">
        </label>
        <p id="file-name-seac" style="font-size: 13px; color: #64748b; text-align: center; margin-top: -15px; margin-bottom: 15px;"></p>
        
        <p style="font-weight: 700; color: #475569; margin-top: 20px;">2. Ejecutar procesamiento:</p>
        <button class="btn" onclick="procesarSEAC('ventas')" style="background: #10b981; width: 100%; height: 50px; font-size: 16px; border-radius: 10px; box-shadow: 0 4px 10px rgba(16, 185, 129, 0.2);">üöÄ PROCESAR VENTAS (EFECTIVO)</button>

        <div id="progreso-seac" style="display:none; margin-top: 25px;">
            <div style="height: 12px; background: #e2e8f0; border-radius: 10px; overflow: hidden;">
                <div id="barra-seac" style="width: 0%; height: 100%; background: #10b981; transition: width 0.3s;"></div>
            </div>
            <p id="txt-proceso" style="font-size: 13px; font-weight: 700; margin-top: 8px; color: #64748b; text-align: center;"></p>
        </div>

        <div id="res-seac" style="margin-top: 25px;"></div>
        
        <div id="log-container" style="display:none; margin-top: 25px;">
            <h4 style="color: #334155; font-size: 14px; border-bottom: 2px solid #e2e8f0; padding-bottom: 8px; font-weight: 900;">AUDITOR√çA DETALLADA:</h4>
            <div id="log-list" style="max-height: 250px; overflow-y: auto; background: #111827; color: #34d399; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 12px; line-height: 1.6; border: 1px solid #374151;">
            </div>
        </div>
    </div>
</div>

<script>
    // SECCION PROHIBIDO TOCAR - INICIO (LOGICA DE SUBIDA)
    async function procesarSEAC(tipo) {
        const input = document.getElementById('fileSEAC');
        const resDiv = document.getElementById('res-seac');
        const logList = document.getElementById('log-list');
        const logCont = document.getElementById('log-container');
        const barra = document.getElementById('barra-seac');
        const progDiv = document.getElementById('progreso-seac');
        
        if (!input.files.length) return customAlert('Por favor, seleccion√° archivos de SEAC.');

        resDiv.innerHTML = "";
        logList.innerHTML = "";
        logCont.style.display = "block";
        progDiv.style.display = "block";

        let totN = 0, totE = 0, totD = 0;

        for (let i = 0; i < input.files.length; i++) {
            const file = input.files[i];
            const p = Math.round(((i + 1) / input.files.length) * 100);
            barra.style.width = p + "%";
            document.getElementById('txt-proceso').innerText = `Analizando: ${file.name} (${i + 1}/${input.files.length})`;

            addLog(`> Leyendo archivo: ${file.name}`, '#94a3b8');

            const fd = new FormData();
            fd.append('archivo', file);
            fd.append('tipo', tipo);

            try {
                const response = await fetch('/importar/seac', { method: 'POST', body: fd });
                const data = await response.json();
                
                if (!response.ok) {
                    addLog(`[ERROR SERVER]: ${data.error}`, '#f87171');
                    totE++;
                    continue;
                }

                if (data.detalles && data.detalles.length > 0) {
                    data.detalles.forEach(d => {
                        let color = '#34d399'; 
                        if(d.status === 'ERROR') color = '#f87171'; 
                        if(d.status === 'DENEGADO') color = '#facc15'; 
                        if(d.status === 'DUPLICADO') color = '#60a5fa'; 
                        addLog(`[${d.status}] PDV: ${d.pdv} | ${d.msg} | $${d.monto || 0}`, color);
                    });
                }
                totN += data.nuevos;
                totE += data.errores;
                totD += data.omitidos;
            } catch (err) {
                addLog(`[ERROR RED]: No hay conexi√≥n con el servidor.`, '#f87171');
                totE++;
            }
        }

        progDiv.style.display = "none";
        resDiv.innerHTML = `
            <div style="padding:20px; background:#f0fdf4; border:2px solid #bbf7d0; border-radius:12px; box-shadow: 0 4px 10px rgba(0,0,0,0.02);">
                <h4 style="margin:0 0 10px 0; color:#166534; font-weight:900; font-size:16px;">RESUMEN FINAL DE CARGA:</h4>
                <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; text-align:center;">
                    <div style="background:white; padding:10px; border-radius:8px; border:1px solid #bbf7d0;"><span style="display:block; font-size:10px; color:#64748b;">NUEVOS</span><b style="font-size:18px; color:#10b981;">${totN}</b></div>
                    <div style="background:white; padding:10px; border-radius:8px; border:1px solid #bbf7d0;"><span style="display:block; font-size:10px; color:#64748b;">OMITIDOS</span><b style="font-size:18px; color:#f59e0b;">${totD}</b></div>
                    <div style="background:white; padding:10px; border-radius:8px; border:1px solid #bbf7d0;"><span style="display:block; font-size:10px; color:#64748b;">ERRORES</span><b style="font-size:18px; color:#ef4444;">${totE}</b></div>
                </div>
            </div>`;
        input.value = "";
    }

    function addLog(txt, color) {
        const div = document.createElement('div');
        div.style.color = color;
        div.style.marginBottom = "4px";
        div.innerText = txt;
        document.getElementById('log-list').appendChild(div);
        document.getElementById('log-list').scrollTop = document.getElementById('log-list').scrollHeight;
    }
    // SECCION PROHIBIDO TOCAR - FIN
</script>